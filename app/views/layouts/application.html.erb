<!DOCTYPE html>
<html>
<head>
  <title>Redis数据库管理</title>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
  <![endif]-->
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= javascript_include_tag "highcharts.js" %>
  <%= csrf_meta_tags %>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
        <a class="brand" href="#">Redis数据库管理</a> 
        <div class="nav-collapse">
          <ul class="nav">
            <li><%= link_to "About SmartRedis", {:action => :index, :controller => :redis_infos} %></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Extra Action<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><%= link_to "Export as Json", {:action => :export, :controller => :redis_infos} %></li>
                <li><%= link_to "Import as Json", {:action => :import, :controller => :redis_infos} %></li>
              </ul>
            </li>
            <li><%= link_to "Graph", {:action => :graph, :controller => :redis_infos} %></li>
            <li><%= link_to "String", {:action => :index, :controller => :stringlists} %></li>
            <li><%= link_to "Sets", {:action => :index, :controller => :products} %></li>
            <li><%= link_to "Sorted Sets", {:action => :index, :controller => :records} %></li>
            <li><%= link_to "List" %></li>
            <li><%= link_to "Hash" %></li>
            <li><%= link_to "Terminal", {:action => :terminal, :controller => :redis_infos} %></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <%= render_breadcrumbs %>
    <div class="row">
      <div class="span9"><%= yield %></div>
      <div class="span3">
        <h2>About <%= image_tag("logo4.png") %> </h2>
        <dl>
        <dt><h3>Why SmartRedis comes here</h3></dt>
        <dd>SmartRedis is a useful web interface to manage Redis databases. There are many commands in controlling Redis database, but they are too complicated for us. SmartRedis can solve the problems by providing graphical tool for you to avoid plenty of commands. It also providing the command line interface if you really to handle it by inputing the commands.</dd>
        <dt><h3>Contributing for SmartRedis</h3></dt>
        <dd>  <span class="label label-info">Good</span>This code is being developed and maintained by Eric. You can send comments, patches, questions here on github or to <a href="shaorui23@gmail.com.">shaorui23@gmail.com</a></dd>
        </dl>
      </div>
    </div>
  </div>

   <div class='modal hide' id='flush-confirm'>
      <div class='modal-header'>
        <a class='close' data-dismiss="modal">x</a>
        <h3>Flush DB</h3>
      </div>
      <div class='modal-body'>
        <p>执行该命令将会删除所有在Redis服务器上的key，确定要删除吗？</p>
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' id='flush-cancel-btn'>取消</button>
        <button class='btn btn-danger' id='flush-confirm-btn'>确定</button>
      </div>
    </div>
  
</body>
</html>
<script type='text/javascript'>
  //<![CDATA[
    $(document).ready(function() {
      Redmon.init({
      //pollInterval : #{poll_interval},
      //cliPrompt    : "#{prompt}"
        cliPrompt    :  "127.0.0.1:6379"
      });
    });
    $(function() {
      new Highcharts.Chart({
        chart: {
          renderTo: 'redis_use',
          plotBackgroundColor: null,
          plotBorderWidth: null,
          plotShadow: false
        },
        title: {
          text: 'DataType use in Redis Database'
        },
        tooltip: {
          formatter: function() {
            return '<b>'+ this.point.name +'</b>: '+ this.percentage +' %';
          }
        },
        plotOptions: {
          pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
              enabled: true,
              color: '#000000',
              connectorColor: '#000000',
              formatter: function() {
                return '<b>'+ this.point.name +'</b>: '+ this.percentage +' %';
              }
            }
          }
        },
        series: [{
          type: 'pie',
          name: 'Browser share',
          //data: <%= @data %>
          data: [
            <% b = 0%>
            <% unless $data.nil? %>
              <% $data.each_with_index do |data,index| %>
                {
                  name: "<%= data.first %>",
                  y: <%= index == ($data.count-1) ? (1-b).round(2) : (data.last).round(2)%>
                },
                <% b += data.last.round(2) %>
              <% end %>
            <% end %>
          ]
        //data: [
        //  ['String',   45.0],
        //  ['Set',       26.8],
        //  {
        //    name: 'Hash',
        //    y: 12.8,
        //    sliced: true,
        //    selected: true
        //  },
        //  ['Sorted Set',    8.5],
        //  ['List',     6.9]
        //]
        }]
      });

      new Highcharts.Chart({
        chart: {
          renderTo: 'memory-container',
          defaultSeriesType: 'areaspline',
          zoomType: 'x'
        },
        title: {text: ''},
        xAxis: {
          type: 'datetime',
          title: {text: null}
        },
        yAxis: {title: null},
        legend: {enabled: false},
        credits: {enabled: false},
        plotOptions: {
          line: {
            shadow: false,
            lineWidth: 3
          },
          series: {
            marker: {
              radius: 0,
              fillColor: '#FFFFFF',
              lineWidth: 2,
              lineColor: null
            },
            fillColor: {
              linearGradient: [0, 0, 0, 300],
              stops: [
                [0, 'rgb(69, 114, 167)'],
                [1, 'rgba(2,0,0,0)']
              ]
            }
          }
        },
        tooltip: {
          formatter: function () {
            return Highcharts.dateFormat("%B %e %Y", this.x) + ': ' +
              '$' + Highcharts.numberFormat(this.y, 2);
          }
        }, 
        series: [
            {
              name: "Memory Used",
              pointInterval: <%= 10 * 1000 %>,
              pointStart: <%= 10 * 1000 %>,
              data: [<%= Redis.current.info["used_memory"] %>]
            }
        ]
      });
    });
  //]]>
</script>
